pipeline {
  agent any

  stages {
    stage('Docker Build & Docker Login') {
      steps {
        sh 'docker login -u $DOCKER_USER -P $DOCKER_PASS'
        sh 'docker build -t vijayjerry/nginx-image .'

      }
    }
 stage('Docker Push') {
      steps {
        sh 'docker push vijayjerry/nginx-image'
      }
    }
    stage('Deploy to Deployment Server') {
    steps {
        script {
            sshagent(['ssh']) {
                sh '''
                    ssh -o StrictHostKeyChecking=no ubuntu@15.206.187.220 "
                        docker stop java_app;
                        docker rm java_app;
                        docker run -d -p 80:80 --name nginx-container vijayjerry/nginx-image
                    "
                '''
            }
        }
    }
}

